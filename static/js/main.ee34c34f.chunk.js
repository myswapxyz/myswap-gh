(this.webpackJsonpamm_app=this.webpackJsonpamm_app||[]).push([[0],{138:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=138},139:function(e,t){},170:function(e,t,n){},196:function(e,t){},204:function(e,t){},205:function(e,t){},226:function(e,t){},241:function(e,t){},242:function(e,t){},243:function(e,t){},244:function(e,t){},245:function(e,t){},246:function(e,t){},250:function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r),c=n(42),a=n.n(c),s=(n(170),n(323)),i=n(325),l=n(327),b=n(339),d=n(13),j=n(14),u=n(7),O=n(25),h=n(17),m=n(322),x=n(326),g=n(150),f=n(310),p=n(328),k=n(317),y=n(318),v=n(141),w=n.n(v),S=n(1);const N="0.50";var E=function(e){const[t,n]=Object(r.useState)(N),[o,c]=Object(r.useState)(null),a=()=>{"Swap"===e.name&&Object(j.c)(W,t),"Add Liquidity"===e.name&&Object(j.c)(P,t),"Remove Liquidity"===e.name&&Object(j.c)(D,t),console.log("Slippage set to: ",t),c(null)};return Object(S.jsx)(m.a,{sx:{flexGrow:1},children:Object(S.jsx)(s.a,{position:"static",children:Object(S.jsxs)(i.a,{children:[Object(S.jsx)(x.a,{size:"large",edge:"start",color:"inherit","aria-label":"menu",onClick:e=>{c(e.currentTarget)},sx:{mr:2,position:"absolute",right:"0%"},children:Object(S.jsx)(w.a,{})}),Object(S.jsx)(l.a,{variant:"h6",component:"div",sx:{flexGrow:1},children:e.name}),Object(S.jsx)("div",{children:Object(S.jsxs)(g.a,{id:"menuAppBar",sx:{boxShadow:1},anchorEl:o,anchorOrigin:{vertical:"top",horizontal:"right"},keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},PaperProps:{style:{width:250}},open:Boolean(o),onClose:a,children:[Object(S.jsx)(f.a,{sx:{fontSize:14,fontWeight:"bold"},children:"Transaction Settings"}),Object(S.jsxs)(f.a,{children:["Set Slippage",Object(S.jsx)(p.a,{sx:{ml:3,mb:0},value:t,size:"small",onChange:e=>{n(e.target.value)},onKeyPress:e=>{"Enter"===e.key&&a()},inputProps:{step:.01,min:0,max:100,type:"number","aria-labelledby":"input-slider"}})]}),Object(S.jsx)(k.a,{item:!0,container:!0,justifyContent:"center",children:Object(S.jsx)(y.a,{variant:"contained",size:"small",sx:{textWeight:"bold",mt:1},onClick:a,children:"OK"})})]})})]})})})};const A=Object(d.b)({key:"walletAddressState",default:""}),B=(Object(d.b)({key:"isWalletConnectedState",default:0}),Object(d.b)({key:"poolsState",default:new Map})),C=Object(d.b)({key:"tokensState",default:new Map}),_=Object(d.b)({key:"tokensUserDataState",default:new Map}),I=Object(d.b)({key:"pendingTxsState",default:new Array}),T=Object(d.b)({key:"toastsState",default:new Array}),W=Object(d.b)({key:"swapSlippage",default:N}),P=Object(d.b)({key:"addLiquiditySlippage",default:N}),D=Object(d.b)({key:"withdrawLiquiditySlippage",default:N}),M=Object(d.d)({key:"transactionsStatusSelector",get:e=>({get:t})=>{let n=t(I);if(n)return n.filter((t=>t.type===e))}}),L=Object(d.c)({key:"walletAmountsSelector",get:({get:e})=>{let t=new Map;return e(_).forEach(((n,r)=>{if(void 0!==n.userBalance){let o=e(C).get(r);o&&o.decimals&&t.set(r,n.userBalance)}})),t}}),z=(Object(d.c)({key:"walletAllowanceSelector",get:({get:e})=>{let t=new Map;return e(_).forEach(((n,r)=>{if(void 0!==n.userApproved){let o=e(C).get(r);o&&o.decimals&&t.set(r,n.userApproved)}})),t}}),Object(d.c)({key:"pendingTxSelector",get:({get:e})=>{let t=new Map;return e(I).forEach((e=>{t.set(e.hash,e.status)})),t}}),Object(d.c)({key:"lastTxDoneSelector",get:({get:e})=>{let t=!0;return e(I).forEach((e=>{t=!1,("RECEIVED"===e.status||e.status.includes("ACCEPTED"))&&(t=!0)})),t}})),F=Object(d.c)({key:"safeToSendTxSelector",get:({get:e})=>{const t=e(I).length;if(0===t)return!0;const n=e(I)[t-1];return!(!n.status.includes("REJECTED")&&!n.status.includes("ACCEPTED"))}}),R=O.stark.getSelectorFromName("swap"),U=O.stark.getSelectorFromName("add_liquidity"),q=O.stark.getSelectorFromName("withdraw_liquidity"),G=O.stark.getSelectorFromName("get_lp_balance"),H="0x008fb0ec84a7025839faafbf9eeee6b6e9957d50bd418a334d00740fbb9f6170",K=Object(u.BigNumber)(H).toString(10),V=O.stark.getSelectorFromName("get_total_number_of_pools"),J=O.stark.getSelectorFromName("get_pool"),Y=O.stark.getSelectorFromName("get_total_shares"),Z=O.stark.getSelectorFromName("approve"),$=O.stark.getSelectorFromName("mint"),Q=O.stark.getSelectorFromName("name"),X=O.stark.getSelectorFromName("symbol"),ee=O.stark.getSelectorFromName("balanceOf"),te=O.stark.getSelectorFromName("allowance"),ne=O.stark.getSelectorFromName("decimals"),re=0,oe=1,ce=2,ae=(e,t=!1)=>{if(void 0===e||""===e)return"";if(t){let t=Object(u.BigNumber)(e).shiftedBy(2).sd(4,u.BigNumber.ROUND_DOWN).toPrecision(4);return Object(u.BigNumber)(t).lt(.01)?"<0.01":t}if(Object(u.BigNumber)(e).lt(1)){let t=Object(u.BigNumber)(e).sd(6).toFixed(18,u.BigNumber.ROUND_DOWN);return Object(u.BigNumber)(t).toString(10)}return Object(u.BigNumber)(e).toFixed(2)},se=e=>{let t=null;if(e){let n=Object(j.b)(_).get(e);n&&(t=n.userApproved,console.log("tokenAllowanceForAMM tud.userApproved = ",n.userApproved))}return t},ie=(e,t)=>{try{let n=se(e);if(n&&Object(u.BigNumber)(n).gte(Object(u.BigNumber)(Se(e,t))))return!0}catch(n){}return!1},le=(e,t,n)=>{e&&e.forEach((e=>{console.log("checkAndUpdateComponentTransactions: ",e.status,e.hash),t.hasOwnProperty(e.hash)&&["REJECTED","PENDING","ACCEPTED"].some((t=>e.status.includes(t)))&&(n(!1),delete t[e.hash])}))},be=(e,t,n,r="1")=>{let o=Object(j.b)(B).get(e),c=Object(u.BigNumber)(1);return o&&(o.token1===t?(console.log("here",o.token2Amount),c=Object(u.BigNumber)(Ne(n,o.token2Amount)).times(Object(u.BigNumber)(r)).div(Object(u.BigNumber)(Ne(t,o.token1Amount)))):c=Object(u.BigNumber)(Ne(n,o.token1Amount)).times(Object(u.BigNumber)(r)).div(Object(u.BigNumber)(Ne(t,o.token2Amount)))),console.log("Ratio",c.toString(10)),c.toString(10)},de=e=>{let t=Oe(),n=Object(j.b)(_).get(e);return t&&e&&n&&void 0!==n.userBalance?Ne(e,n.userBalance):""},je=(e,t)=>{let n=Oe(),r=Object(j.b)(_).get(e);if(!n)return ce;if(!e)return ce;if(!t)return oe;if(!r)return ce;if(void 0===r.userBalance)return ce;let o=Ne(e,r.userBalance);return Object(u.BigNumber)(t).isPositive()&&Object(u.BigNumber)(t).lte(Object(u.BigNumber)(o))?oe:re},ue=(e,t)=>{let n={msg:e,type:t,dismiss:!1,hash:u.BigNumber.random(10).times(1e10).toString(16)};Object(j.c)(T,(e=>[...e,n]))},Oe=()=>Object(j.b)(A),he=async e=>{console.log("updatePoolsAndTokens");const t=Object(h.getStarknet)();let n=await t.provider.callContract({contract_address:H,entry_point_selector:V,calldata:[]}),r=Number(n.result[0]),o=Object(j.b)(B),c=Object(j.b)(C),a=new Map,s=new Map(c);for(let i=1;i<=r;i++){let n=o.get(i);if(n&&n.refresh>Date.now()-6e4){a.set(i,n);continue}let r=await t.provider.callContract({contract_address:H,entry_point_selector:J,calldata:[i.toString()]}),c=await t.provider.callContract({contract_address:H,entry_point_selector:Y,calldata:[i.toString()]});console.log(r);let l={id:i,name:ye(r.result[0]),token1:r.result[1],token1Amount:pe(r.result[2],r.result[3]),token2:r.result[4],token2Amount:pe(r.result[5],r.result[6]),fee:Number(r.result[7])/1e5,cfmm:Number(r.result[8]),shares:pe(c.result[0],c.result[1]),refresh:Date.now()};if(a.set(i,l),e){if(!s.get(l.token1)){let e=s.size;console.log("new token1 n=",e);let t={address:l.token1,id:e,name:"",symbol:"",icon:"",decimals:0};s.set(l.token1,t)}if(!s.get(l.token2)){let e=s.size;console.log("new token2 n=",e);let t={address:l.token2,id:e,name:"",symbol:"",icon:"",decimals:0};s.set(l.token2,t)}}}if(e){let e=[];s.forEach(((n,r)=>{let o=t.provider.callContract({contract_address:r,entry_point_selector:Q,calldata:[]}).then((e=>{const t=ye(e.result[0]);console.log("name=",t),n.name=t}));e.push(o);let c=t.provider.callContract({contract_address:r,entry_point_selector:X,calldata:[]}).then((e=>{const t=ye(e.result[0]);console.log("symbol=",t),n.symbol=t}));e.push(c);let a=t.provider.callContract({contract_address:r,entry_point_selector:ne,calldata:[]}).then((e=>{const t=Number(e.result[0]);n.decimals=t}));e.push(a)})),await Promise.allSettled(e),Object(j.c)(C,s),console.log("tokens=",s)}Object(j.c)(B,a)},me=async()=>{Object(j.b)(C).forEach(((e,t)=>{console.log("updateAllTokensDynamicData: token=",t),ge(t)}))},xe=async e=>{if(console.log("updatePoolDynamicData"),!Oe())return null;let t=Object(j.b)(B),n=Object(j.b)(C);if(!1===Object(h.getStarknet)().isConnected)throw Error("starknet wallet not connected");let r=t.get(e);if(!r)throw Error("unknown pool "+e);let o=n.get(r.token1),c=n.get(r.token2);if(!o)throw Error("missing token "+r.token1);if(!c)throw Error("missing token "+r.token2);ge(r.token1),ge(r.token2)},ge=async e=>{if(!e)return null;const t=Object(h.getStarknet)();let n=[],r=Oe();if(!r)return null;let o=Object(j.b)(_).get(e);if(o){const e=Date.now()-6e4;if(o.refresh>e)return null}else Object(j.c)(_,(t=>{let n=new Map(t);if(!n.get(e)){let t={address:e,refresh:Date.now(),ammBalance:void 0,userBalance:void 0,userApproved:void 0};n.set(e,t)}return n}));let c=t.provider.callContract({contract_address:e,entry_point_selector:ee,calldata:[K]}).then((t=>{const n=pe(t.result[0],t.result[1]);Object(j.c)(_,(t=>{let r=new Map(t),o=r.get(e);return o&&(o.ammBalance=n,r.set(o.address,o)),r}))}));n.push(c);let a=t.provider.callContract({contract_address:e,entry_point_selector:ee,calldata:[ke(r)]}).then((t=>{const n=pe(t.result[0],t.result[1]);Object(j.c)(_,(t=>{let r=new Map(t),o=r.get(e);return o&&(o.userBalance=n,r.set(o.address,o)),r}))}));n.push(a);let s=t.provider.callContract({contract_address:e,entry_point_selector:te,calldata:[ke(r),ke(H)]}).then((t=>{const n=pe(t.result[0],t.result[1]);Object(j.c)(_,(t=>{let r=new Map(t),o=r.get(e);return o&&(o.userApproved=n,r.set(o.address,o)),r}))}));n.push(s),await Promise.allSettled(n)};function fe(e,t){let n={hash:e,type:t,status:"new",dismiss:!1};Object(j.c)(I,(e=>[...e,n]))}const pe=(e,t)=>Object(u.BigNumber)(e).plus(Object(u.BigNumber)(t).times(Object(u.BigNumber)(2).pow(128))).toString(10),ke=e=>Object(u.BigNumber)(e).toString(10);function ye(e){for(var t=e.substr(2).toString(),n="",r=0;r<t.length;r+=2)n+=String.fromCharCode(parseInt(t.substr(r,2),16));return n}function ve(e){return e.length<=8?e:e.substr(0,5)+"..."+e.substr(-3)}const we=(e,t)=>{let n=Object(j.b)(B),r=Object(j.b)(C);if(!r.get(e)||!r.get(t))throw Error("Unknown tokens");let[o,c]=function(e,t){return Object(u.BigNumber)(e)<Object(u.BigNumber)(t)?[e,t]:[t,e]}(e,t);for(let a=1;a<=n.size;a++){let e=n.get(a);if(!e)throw Error("missing pool "+a);if(e.token1===o&&e.token2===c)return a}return 0};function Se(e,t){let n=Object(j.b)(C),r=n.get(e);return void 0===r?(ue("float_to_decimal_int: Undefined pool for token "+e+", tokens size="+n.size+" amount="+t,"warning"),"0"):Object(u.BigNumber)(t).shiftedBy(r.decimals).toFixed(0,u.BigNumber.ROUND_DOWN)}function Ne(e,t){let n=Object(j.b)(C),r=n.get(e);return void 0===r?(ue("decimal_int_to_float: Undefined pool for token "+e+", tokens size="+n.size+" amount="+t,"warning"),"0"):Object(u.BigNumber)(t).shiftedBy(-r.decimals).toString(10)}const Ee=(e,t,n,r)=>{let o=we(e,t);if(0===o||void 0===n||null===n)return;if(""===n)return"";let c=Se(e,n),a=Object(j.b)(B).get(o);if(void 0===a)return void ue("Undefined pool id="+o,"warning");let s="0",i="0";if(a.token1===e?(s=a.token1Amount,i=a.token2Amount):(s=a.token2Amount,i=a.token1Amount),Object(u.BigNumber)(s).lte(0)||Object(u.BigNumber)(i).lte(0))throw Error("token reserve cannot be 0");if(1===r){return Ne(t,Object(u.BigNumber)(i).times(Object(u.BigNumber)(c)).div(Object(u.BigNumber)(s).plus(Object(u.BigNumber)(c))).toFixed(0,u.BigNumber.ROUND_DOWN))}return Ne(t,Object(u.BigNumber)(i).times(Object(u.BigNumber)(c)).div(Object(u.BigNumber)(s).minus(Object(u.BigNumber)(c))).toFixed(0,u.BigNumber.ROUND_DOWN))},Ae=(e,t,n)=>{let r=we(e,t);if(0===r||void 0===n||null===n)return;if(""===n)return"";let o=Se(e,n);if(void 0===Object(j.b)(B).get(r))return void ue("Undefined pool id="+r,"warning");let c=be(r,e,t,o);return console.log("Other Token Add Liquidity: ",c,o),Ne(t,c)},Be=()=>!!Object(j.b)(F)||(ue("Previous Transaction still being processed by your wallet, try again later","error"),!1),Ce="https://my-json-server.typicode.com/mottyl/static_data";var _e=n(329),Ie=n(330),Te=n(331),We=n(313),Pe=n(309),De=n(314),Me=n(306),Le=n(144),ze=n.n(Le),Fe=n(145),Re=n.n(Fe),Ue=n(59),qe=n.n(Ue),Ge=n(52),He=n(142),Ke=n.n(He);const Ve=BigInt(2**127-1).toString();var Je=function(e){const[t]=Object(d.f)(C),[n]=Object(d.f)(A),[o,c]=Object(r.useState)(!1),[a]=Object(d.f)(M("approve")),[s,i]=Object(r.useState)({});Object(r.useEffect)((()=>{le(a,s,c)}),[a,s]);let l=e.token,b=e.tokenAmount,j=e.activePoolId,u=e.tokenInRange;const O=async()=>{c(!0);let e=Ve||Se(l,b);try{let t=await(async(e,t)=>{console.log("approve");const n=Object(h.getStarknet)();if(!Oe())return null;if(!1===n.isConnected)throw Error("starknet wallet not connected");if(!Be())return null;let r=await n.signer.invokeFunction(e,Z,[ke(H),ke(t),ke(0)]);return fe(r.transaction_hash,"approve"),r})(l,e);if(!t)throw Error("Cannot perform transaction");i((e=>({...e,[t.transaction_hash]:"new"})))}catch(t){ue("Approve user abort","error"),c(!1)}};if(n&&l&&b>0&&j>0&&u&&!ie(l,b)){let e=t.get(l);if(e)return Object(S.jsx)(Me.a,{color:"inherit",variant:"outlined",fullWidth:!0,loading:!(!o&&null!==se(l)&&void 0!==se(l)),loadingPosition:"start",startIcon:Object(S.jsx)(Ke.a,{}),onClick:O,children:null===se(l)||void 0===se(l)?"CHECKING "+e.symbol+" ALLOWANCE":"APPROVE "+e.symbol})}return Object(S.jsx)("div",{})};var Ye=function(e){let t=e.token,n=e.showMaxButton,r=e.setMaxAmountHandler,o=e.amount;return void 0===o||""===o?Object(S.jsx)("div",{}):Object(S.jsx)("div",{children:Object(S.jsxs)(k.a,{container:!0,children:[Object(S.jsx)(l.a,{fontSize:13,sx:{ml:2,mt:.5},children:"Balance: "+ae(o)}),n&&Object(S.jsx)(y.a,{size:"small",sx:{ml:-1.5,mt:-.2},onClick:()=>r(t,o),children:"max"})]})})};const Ze=async()=>{try{const[e]=await Object(h.getStarknet)().enable();return e}catch{}},$e=()=>{try{return Object(h.getStarknet)().provider.baseUrl.includes("alpha-mainnet.starknet.io")?"mainnet-alpha":"goerli-alpha"}catch{return"goerli-alpha"}},Qe=()=>"mainnet-alpha"===$e()?"https://voyager.online":"https://goerli.voyager.online";var Xe=n(71);const et=e=>{Xe.a.pageview(e)},tt=e=>{((e,t,n)=>{Xe.a.event({category:e,action:t,label:n})})("button","click",e)};var nt=n(143),rt=n.n(nt);var ot=function(e){const[t,n]=Object(r.useState)(0),[o,c]=Object(r.useState)(""),[a,s]=Object(r.useState)(""),[i,l]=Object(r.useState)(!1),[b,j]=Object(d.f)(A),[u]=Object(d.f)(B),O=async()=>{tt("connect_wallet"),n(1);try{await(async()=>await Object(h.getStarknet)({showModal:!0}).enable())()}catch{return ue("Wallet not found","error"),void n(0)}j(await Ze()),n(2),ue("Wallet connected","success")};if(Object(r.useEffect)((()=>{if(e.secondary)return;const t=async t=>{e.secondary||(console.log("handleWalletChange: ",t),j(await Ze()),c(Qe()),s($e()),me(),ue("Wallet network/account change","success"))};console.log("address has changed, ",b),b&&(n(2),me(),c(Qe()),s($e()),e.secondary||i||((async e=>{Object(h.getStarknet)().on("accountsChanged",e)})(t),l(!0)))}),[b,e.secondary,i,j]),Object(r.useEffect)((()=>{e.secondary}),[u,e.secondary]),e.secondary)return""!==b||2===t?Object(S.jsx)("div",{}):1===t?Object(S.jsx)("div",{children:Object(S.jsx)(y.a,{color:"inherit",fullWidth:!0,variant:"outlined",disabled:!0,children:"Connecting..."})}):Object(S.jsx)("div",{children:Object(S.jsxs)(y.a,{className:"connect-wallet",color:"inherit",fullWidth:!0,variant:"contained",onClick:O,children:[Object(S.jsx)(qe.a,{fontSize:"medium",sx:{mr:1}}),"CONNECT WALLET"]})});const m=async()=>{console.log("opening wallet"),window.open(o+"/contract/"+b,"_blank")};return 2===t?(console.log("Wallet is connected!",b),Object(S.jsx)("div",{children:Object(S.jsxs)(y.a,{color:"inherit",variant:"outlined",onClick:m,children:[Object(S.jsx)(rt.a,{sx:{mr:1},style:{fill:"lightgreen",fontSize:10}})," ",a," ",ve(b)," "]})})):1===t?(console.log("Wallet is being connected!",b),Object(S.jsx)("div",{children:Object(S.jsx)(y.a,{color:"inherit",variant:"outlined",disabled:!0,children:"Connecting..."})})):Object(S.jsx)("div",{children:Object(S.jsx)(y.a,{color:"inherit",variant:"outlined",onClick:O,children:"Connect Wallet"})})};Number.MAX_SAFE_INTEGER;var ct=function(){const[e,t]=Object(r.useState)(0),[n,o]=Object(r.useState)(""),[c,a]=Object(r.useState)(""),[s,i]=Object(r.useState)(""),[b,O]=Object(r.useState)(""),[g,p]=Object(r.useState)(0),[v,w]=Object(r.useState)(!1),[N]=Object(d.f)(C),[I]=Object(d.f)(_),[T]=Object(d.f)(B),[P]=Object(d.f)(A),[D]=Object(d.f)(M("swap")),[L,z]=Object(r.useState)({});Object(r.useEffect)((()=>{et("swap")}),[]),Object(r.useEffect)((()=>{le(D,L,w)}),[D,L]),Object(r.useEffect)((()=>{}),[I,T]),Object(Ge.a)((async()=>{e>0?xe(e):(n&&ge(n),s&&ge(s))}),15e3);const F=(e,t)=>{const r=/^(([0-9]+[.]?[0-9]*)|([.][0-9]+))$/;e!==n||""!==t&&!r.test(t)||(a(t),p(1)),e!==s||""!==t&&!r.test(t)||(O(t),p(2))};Object(r.useEffect)((()=>{if(n&&s){let e=we(n,s);if(t(e),g<=1)if(e>0){let e=Ee(n,s,c,1);console.log("calcOtherTokenAmount: (token1 leading) ",e),void 0!==e&&e!==b&&O(e)}else O(0);else if(e>0){let e=Ee(s,n,b,2);console.log("calcOtherTokenAmount: (token2 leading) ",e),void 0!==e&&e<0?e=0:void 0!==e&&e!==c&&a(e)}else a(0)}else g<=1?O(""):a("")}),[n,s,c,b,g]);const U=e=>{let t=[];return N.forEach(((n,r)=>{e!==r&&t.push(Object(S.jsx)(f.a,{value:r,children:Object(S.jsxs)(k.a,{container:!0,direction:"row",children:[Object(S.jsx)(k.a,{sx:{mr:1,mb:-1},children:Object(S.jsx)("img",{src:n.icon,alt:"",width:"24",height:"24"})}),Object(S.jsx)(k.a,{children:Object(S.jsx)(l.a,{children:n.symbol||n.address})})]})},r))})),t},q=()=>{let e=parseFloat(Object(j.b)(W))/100;return Object(u.BigNumber)(b).times(Object(u.BigNumber)(1).minus(Object(u.BigNumber)(e)))},G=async()=>{w(!0);let t=q();try{let r=await(async(e,t,n,r)=>{console.log("swap");const o=Object(h.getStarknet)();if(!Oe())return null;if(!1===o.isConnected)throw Error("starknet wallet not connected");if(!Be())return null;let c=await o.signer.invokeFunction(H,R,[ke(e),ke(t),ke(n),ke(0),ke(r),ke(0)]);return fe(c.transaction_hash,"swap"),c})(e,n,Se(n,c),Se(s,t));if(!r)throw Error("Cannot perform transaction");z((e=>({...e,[r.transaction_hash]:"new"})))}catch(r){ue("Swap Request: User Aborted","error"),w(!1)}},[K,V]=Object(r.useState)(0),[J]=Object(d.f)(W);return Object(S.jsx)(m.a,{sx:{p:2,border:"0px solid",mt:1,mb:4,boxShadow:2},children:Object(S.jsxs)("div",{children:[Object(S.jsx)(k.a,{container:!0,sx:{mb:2},children:Object(S.jsx)(E,{name:"Swap"})}),Object(S.jsx)(_e.a,{sx:{p:2,boxShadow:2,mb:-4},children:Object(S.jsxs)(k.a,{container:!0,spacing:2,sx:{},children:[Object(S.jsxs)(k.a,{item:!0,xs:6,children:[Object(S.jsxs)(Te.a,{fullWidth:!0,children:[Object(S.jsx)(We.a,{id:"token1-label",children:"Token 1:"}),Object(S.jsx)(Pe.a,{labelId:"token1-label",id:"token1-select",value:n,label:"Token 1",onChange:e=>{let t=e.target.value;o(t),ge(t),tt("swap-token1")},children:U(s)})]}),Object(S.jsx)(Ye,{token:n,amount:de(n),showMaxButton:!0,setMaxAmountHandler:F})]}),Object(S.jsx)(k.a,{item:!0,xs:6,children:Object(S.jsx)(Te.a,{fullWidth:!0,children:Object(S.jsx)(De.a,{helperText:"Amount to swap",id:"token1-amount",inputProps:{variant:"outlined",placeholder:"0.00",type:"string",autoComplete:"off","aria-labelledby":"input-amount"},value:c||"",onChange:e=>F(n,e.target.value),error:je(n,c)===re,disabled:""===n})})})]})}),Object(S.jsx)(k.a,{container:!0,direction:"row",justifyContent:"center",alignItems:"center",children:Object(S.jsx)(x.a,{size:"large",disabled:!n&&!s,onClick:()=>{tt("swap-switchtokens");let e=n,t=c;o(s),i(e),a(b),O(t),p(1===g?2:1)},children:Object(S.jsx)(Re.a,{style:{fontSize:40}})})}),Object(S.jsx)(_e.a,{sx:{p:2,mt:-3,boxShadow:2},children:Object(S.jsxs)(k.a,{container:!0,spacing:2,children:[Object(S.jsxs)(k.a,{item:!0,xs:6,children:[Object(S.jsxs)(Te.a,{fullWidth:!0,children:[Object(S.jsx)(We.a,{id:"token2-label",children:"Token 2:"}),Object(S.jsx)(Pe.a,{labelId:"token2-label",id:"token2-select",value:s,label:"Token 2",onChange:e=>{let t=e.target.value;i(t),ge(t),tt("swap-token2")},children:U(n)})]}),Object(S.jsx)(Ye,{token:s,amount:de(s),showMaxButton:!1})]}),Object(S.jsx)(k.a,{item:!0,xs:6,children:Object(S.jsx)(Te.a,{fullWidth:!0,children:Object(S.jsx)(De.a,{helperText:"Estimated amount received",id:"token2-amount",inputProps:{variant:"outlined",placeholder:"0.00",type:"string",autoComplete:"off","aria-labelledby":"input-amount"},value:b||"",onChange:e=>F(s,e.target.value),disabled:""===s})})})]})}),(()=>{if(n&&s&&c&&!Object(u.BigNumber)(c).isZero()&&b&&!Object(u.BigNumber)(b).isZero()){let t=be(e,n,s);console.log("CurrentPrice: ",t);let r=q(),o=N.get(n).symbol,a=N.get(s).symbol,i=parseFloat(J),d=Object(u.BigNumber)(b).div(Object(u.BigNumber)(c)),j=Object(u.BigNumber)(c).div(Object(u.BigNumber)(b)),O=Object(u.BigNumber)(1).minus(Object(u.BigNumber)(d).div(Object(u.BigNumber)(t))),h=O.gt(.05)?"tomato":O.gt(.03)?"orange":"inherit",m=Object(S.jsxs)(S.Fragment,{children:["1 ",o," = ",ae(d)," ",a]}),x=Object(S.jsxs)(S.Fragment,{children:["1 ",a," = ",ae(j)," ",o]});return Object(S.jsxs)(k.a,{children:[Object(S.jsx)(_e.a,{sx:{mb:.5,mt:2},children:Object(S.jsx)(Ie.a,{onClick:()=>V(!K),children:Object(S.jsx)(l.a,{fontSize:13,fontWeight:"medium",sx:{ml:1,mr:1},children:K?x:m})})}),Object(S.jsxs)(_e.a,{style:{backgroundColor:h},sx:{mb:2},children:[Object(S.jsxs)(l.a,{fontSize:13,fontWeight:"medium",sx:{ml:1,mr:1},children:["Minimum amount received (slippage=",i.toFixed(2),"%): ",ae(r)]}),Object(S.jsxs)(l.a,{fontSize:13,fontWeight:"medium",sx:{ml:1,mr:1},children:["Price impact: ",ae(O,!0),"%"]})]})]})}return Object(S.jsx)("div",{})})(),Object(S.jsxs)(_e.a,{sx:{minWidth:275,mb:2,mt:3,boxShadow:2},children:[Object(S.jsx)(ot,{secondary:"true"}),Object(S.jsx)(Je,{token:n,tokenAmount:c,activePoolId:e,tokenInRange:je(n,c)===oe}),(()=>{tt("swap");let t=je(n,c),r=((e,t,n)=>{if(!t||e<=0)return!1;let r=Object(j.b)(B).get(e);if(!r)throw Error("missing pool "+e);let o=Se(t,n);return r.token1===t?Object(u.BigNumber)(o).gt(Object(u.BigNumber)(r.token1Amount)):Object(u.BigNumber)(o).gt(Object(u.BigNumber)(r.token2Amount))})(e,s,b);if(s&&c>0&&0!==e&&t===oe&&!r)return Object(S.jsx)(Me.a,{color:"primary",variant:"contained",fullWidth:!0,disabled:!(P&&ie(n,c)||v),loading:v,loadingPosition:"start",startIcon:Object(S.jsx)(ze.a,{}),onClick:G,children:v?"SWAPPING":"SWAP"});if(P&&c>0&&t!==oe&&!r)return Object(S.jsx)(Me.a,{color:"primary",variant:"contained",fullWidth:!0,disabled:!0,loading:t===ce,loadingPosition:"start",startIcon:Object(S.jsx)(qe.a,{}),children:t===re?"AMOUNT EXCEEDS WALLET BALANCE":"CHECKING WALLET BALANCE"});if(n&&s&&0===e)return Object(S.jsx)(y.a,{color:"primary",variant:"contained",fullWidth:!0,disabled:!0,children:"NOT A VALID Pool"});if(n&&s&&e&&b&&r)return Object(S.jsx)(y.a,{color:"primary",variant:"contained",fullWidth:!0,disabled:!0,children:"INSUFFICIENT LIQUIDITY IN POOL"});if(P){let e="";if(n||s||(e="SELECT TOKENS"),(!n&&s||n&&!s)&&(e="SELECT TOKEN"),!n||!s||c&&b||(e="ENTER AMOUNT"),""!==e)return Object(S.jsx)(y.a,{color:"secondary",variant:"contained",fullWidth:!0,disabled:!0,children:e})}return Object(S.jsx)("div",{})})()]})]})})},at=n(336),st=n(147),it=n.n(st),lt=n(3),bt=n(324),dt=n(302),jt=n(337),ut=n(320),Ot=n(321),ht=n(333),mt=n(311),xt=n(334),gt=n(335),ft=n(146),pt=n.n(ft);const kt=Object(lt.a)(bt.a)((({theme:e})=>({...e.typography.body2,padding:e.spacing(0),textAlign:"left",color:e.palette.text.secondary}))),yt=Object(lt.a)(p.a)`
    width: 42px;
`;function vt(e){const[t,n]=Object(r.useState)(!1),[o,c]=Object(r.useState)(25),[a,s]=Object(r.useState)(""),[i,b]=Object(r.useState)(""),[O,x]=Object(r.useState)(0),[g]=Object(d.f)(M("withdraw_liquidity")),[f,p]=Object(r.useState)({});Object(r.useEffect)((()=>{le(g,f,x)}),[g,f]);Object(r.useEffect)((()=>{Object(u.BigNumber)(a).isZero()&&b("0"),Object(u.BigNumber)(i).isZero()&&s("0"),s(ae(Object(u.BigNumber)(e.token1Amount).times(o).shiftedBy(-2))),b(ae(Object(u.BigNumber)(e.token2Amount).times(o).shiftedBy(-2))),x(0)}),[t,a,i,o,e.token1Amount,e.token2Amount]);const v=()=>{x(0),n(!1)},w=t=>{c(t),(t=>{s(ae(Object(u.BigNumber)(e.token1Amount).times(t).shiftedBy(-2))),b(ae(Object(u.BigNumber)(e.token2Amount).times(t).shiftedBy(-2)))})(t),console.log("Remove Liquidity, updateState: ",a,i,e.token1Amount,e.token2Amount)};return Object(S.jsxs)("div",{children:[Object(S.jsx)(y.a,{variant:"contained",sx:{textWeight:"bold"},onClick:()=>{n(!0)},children:"WITHDRAW"}),Object(S.jsx)(ut.a,{open:t,onClose:v,children:Object(S.jsxs)(m.a,{sx:{p:2,border:"0px solid",boxShadow:2},children:[Object(S.jsx)(k.a,{container:!0,sx:{mb:2},children:Object(S.jsx)(E,{name:"Remove Liquidity"})}),Object(S.jsxs)(Ot.a,{children:[Object(S.jsxs)(_e.a,{sx:{p:2,border:"0px solid",boxShadow:2,mb:2},children:[Object(S.jsx)(ht.a,{children:"Choose amount of liquidity shares to remove"}),Object(S.jsx)(m.a,{sx:{width:500,mt:3,ml:2},children:Object(S.jsxs)(k.a,{container:!0,spacing:2,alignItems:"center",children:[Object(S.jsx)(k.a,{item:!0,xs:!0,sx:{mt:2,ml:2,mr:2},children:Object(S.jsx)(mt.a,{"aria-label":"Custom marks",defaultValue:25,valueLabelDisplay:"auto",marks:[{value:0,label:"0%"},{value:25,label:"25%"},{value:50,label:"50%"},{value:75,label:"75%"},{value:100,label:"100%"}],value:"number"===typeof o?o:0,onChange:(e,t)=>{w(t)},"aria-labelledby":"input-slider"})}),Object(S.jsx)(k.a,{item:!0,sx:{ml:2,mr:4},children:Object(S.jsx)(yt,{value:o,size:"small",onChange:e=>{let t=""===e.target.value?"":Number(e.target.value);w(t),console.log("handle input change")},onBlur:()=>{o<0?c(0):o>100&&c(100)},inputProps:{step:1,min:0,max:100,type:"number","aria-labelledby":"input-slider"}})})]})})]}),Object(S.jsxs)(_e.a,{sx:{p:2,border:"0px solid",boxShadow:2,mb:0},children:[Object(S.jsx)(xt.a,{title:"Amount Received",disableTypography:!0,sx:{fontSize:18,mt:0}}),Object(S.jsxs)(k.a,{item:!0,container:!0,alignItems:"center",spacing:2,sx:{width:400,ml:2},children:[Object(S.jsxs)(k.a,{item:!0,xs:6,children:[Object(S.jsxs)(dt.a,{direction:"row",spacing:0,alignItems:"center",children:[Object(S.jsx)(kt,{sx:{boxShadow:0,mr:1},style:{backgroundColor:"transparent"},children:Object(S.jsx)("img",{src:e.token1Icon,alt:"",width:"32",height:"32"})}),Object(S.jsx)(kt,{sx:{boxShadow:0},children:Object(S.jsxs)(l.a,{sx:{fontSize:18},children:[e.token1Symbol,":"]})})]}),Object(S.jsxs)(dt.a,{direction:"row",spacing:0,alignItems:"center",children:[Object(S.jsx)(kt,{sx:{boxShadow:0,mr:1},style:{backgroundColor:"transparent"},children:Object(S.jsx)("img",{src:e.token2Icon,alt:"",width:"32",height:"32"})}),Object(S.jsx)(kt,{sx:{boxShadow:0},children:Object(S.jsxs)(l.a,{sx:{fontSize:18},children:[e.token2Symbol,":"]})})]})]}),Object(S.jsx)(k.a,{item:!0,xs:6,children:Object(S.jsxs)(dt.a,{children:[Object(S.jsx)(kt,{sx:{boxShadow:0},children:Object(S.jsx)(l.a,{sx:{fontSize:18},children:ae(a)})}),Object(S.jsx)(kt,{sx:{boxShadow:0},children:Object(S.jsx)(l.a,{sx:{fontSize:18},children:ae(i)})})]})})]})]})]}),Object(S.jsxs)(gt.a,{children:[Object(S.jsx)(y.a,{variant:"contained",style:{backgroundColor:"gray"},onClick:v,children:"Cancel"}),Object(S.jsx)(Me.a,{color:"primary",variant:"contained",disabled:!("0"!==a&&"0"!==i&&!O),loading:1===O,loadingPosition:"start",startIcon:Object(S.jsx)(pt.a,{}),onClick:async()=>{console.log("Withdraw percent: ",o);let t=parseFloat(Object(j.b)(D))/100,n=Object(u.BigNumber)(e.balance).times(Object(u.BigNumber)(o)).shiftedBy(-2).toFixed(2,u.BigNumber.ROUND_DOWN),r=Object(u.BigNumber)(a).times(Object(u.BigNumber)(1).minus(Object(u.BigNumber)(t).shiftedBy(-2))).toString(10,u.BigNumber.ROUND_DOWN),c=Object(u.BigNumber)(i).times(Object(u.BigNumber)(1).minus(Object(u.BigNumber)(t).shiftedBy(-2))).toString(10,u.BigNumber.ROUND_DOWN);x(1),console.log("handleWithdraw: ",n,r,c);try{let t=await(async(e,t,n,r)=>{console.log("withdraw_liquidity");const o=Object(h.getStarknet)();let c=Oe();if(!1===o.isConnected||!c)return null;if(console.log("Calling Starknet: withdraw_liquidity with ",e,t,n,r),!Be())return null;let a=await o.signer.invokeFunction(H,q,[ke(e),ke(t),ke(0),ke(n),ke(0),ke(r),ke(0)]);return fe(a.transaction_hash,"withdraw_liquidity"),a})(e.poolId,n,Se(e.token1,r),Se(e.token2,c));if(!t)throw Error("Cannot perform transaction");p((e=>({...e,[t.transaction_hash]:"new"})))}catch(s){ue("Remove Liquidity: User Aborted","error"),x(0)}v()},children:O?"REMOVING":"REMOVE"})]})]})})]})}const wt=Object(lt.a)(bt.a)((({theme:e})=>({...e.typography.body2,padding:e.spacing(0),textAlign:"left",color:e.palette.text.secondary})));var St=function(e){const[t]=Object(d.f)(C),[n]=Object(d.f)(B);let r=n.get(e.poolId);if(!r||!r.shares)return Object(S.jsx)("div",{});const o=()=>{let r=n.get(e.poolId).token1;return t.get(r)},c=()=>o(e.poolId).symbol,a=()=>o(e.poolId).icon,s=()=>{let t=n.get(e.poolId);return t.shares?Object(u.BigNumber)(e.balance).div(Object(u.BigNumber)(t.shares)):"0"},i=()=>Ne(r.token1,(()=>{let t=n.get(e.poolId),r=s();return Object(u.BigNumber)(r).times(t.token1Amount)})()),b=()=>{let r=n.get(e.poolId).token2;return t.get(r)},j=()=>b(e.poolId).symbol,O=()=>b(e.poolId).icon,h=()=>Ne(r.token1,(()=>{let t=n.get(e.poolId),r=s();return Object(u.BigNumber)(r).times(t.token2Amount)})());return Object(S.jsxs)(_e.a,{sx:{p:2,border:"0px solid",boxShadow:2,mb:5},children:[Object(S.jsx)(l.a,{sx:{fontSize:18,fontWeight:"500"},children:"Your Position"}),Object(S.jsx)(at.a,{children:Object(S.jsxs)(k.a,{item:!0,container:!0,direction:"row",alignItems:"center",children:[Object(S.jsxs)(k.a,{item:!0,xs:6,children:[Object(S.jsxs)(dt.a,{direction:"row",spacing:0,alignItems:"center",children:[Object(S.jsx)(wt,{sx:{boxShadow:0,mr:0},style:{backgroundColor:"transparent"},children:Object(S.jsx)("img",{src:a(),alt:"",width:"32",height:"32"})}),Object(S.jsx)(wt,{sx:{boxShadow:0,ml:-1,mr:1},style:{backgroundColor:"transparent"},children:Object(S.jsx)("img",{src:O(),alt:"",width:"32",height:"32"})}),Object(S.jsx)(wt,{sx:{boxShadow:0},children:Object(S.jsxs)(l.a,{sx:{fontSize:24,fontWeight:"normal"},color:"text.primary",gutterBottom:!0,children:[c()," / ",j(),":"]})})]}),Object(S.jsx)(l.a,{sx:{fontSize:16,fontWeight:"normal"},color:"text.primary",children:"Your Pool Share:"}),Object(S.jsxs)(l.a,{sx:{fontSize:16,fontWeight:"normal"},color:"text.primary",children:["Pooled ",c(),":"]}),Object(S.jsxs)(l.a,{sx:{fontSize:16,fontWeight:"normal"},color:"text.primary",children:["Pooled ",j(),":"]})]}),Object(S.jsxs)(k.a,{item:!0,xs:6,textAlign:"right",children:[Object(S.jsx)(l.a,{sx:{fontSize:24,fontWeight:"normal"},color:"text.primary",gutterBottom:!0,children:e.balance}),Object(S.jsxs)(l.a,{sx:{fontSize:16,fontWeight:"bold"},color:"text.primary",children:[ae(s(),!0),"%"]}),Object(S.jsx)(l.a,{sx:{fontSize:16,fontWeight:"bold"},color:"text.primary",children:ae(i())}),Object(S.jsx)(l.a,{sx:{fontSize:16,fontWeight:"bold"},color:"text.primary",children:ae(h())})]})]})}),Object(S.jsx)(jt.a,{children:Object(S.jsx)(k.a,{item:!0,container:!0,justifyContent:"center",children:Object(S.jsx)(vt,{poolId:e.poolId,balance:e.balance,token1Symbol:c(),token2Symbol:j(),token1Icon:a(),token2Icon:O(),token1:o().address,token2:b().address,token1Amount:i(),token2Amount:h()})})})]})};var Nt=function(){const[e]=Object(d.f)(B),[t]=Object(d.f)(A),[n,o]=Object(r.useState)((()=>new Map));return Object(r.useEffect)((()=>{async function n(e){const n=await(async(e,t)=>{const n=Object(h.getStarknet)();if(!t)return null;if(!1===n.isConnected)throw Error("starknet wallet not connected");let r=await n.provider.callContract({contract_address:H,entry_point_selector:G,calldata:[ke(e),ke(t)]});return pe(r.result[0],r.result[1])})(e,t);n&&o((t=>{let r=new Map(t);return r.set(e,n),r}))}t&&e.forEach((e=>{n(e.id)}))}),[t,e]),Object(S.jsx)("div",{children:(()=>{let e=[];return n.forEach(((t,n)=>{Object(u.BigNumber)(t).isZero()||(e.push(Object(S.jsx)(St,{poolId:n,balance:t},n)),xe(n))})),e})()})};var Et=function(){const[e]=Object(d.f)(C),[t]=Object(d.f)(B),[n,o]=Object(r.useState)(""),[c,a]=Object(r.useState)(""),[s,i]=Object(r.useState)(""),[b,O]=Object(r.useState)(""),[x,g]=Object(r.useState)(0),[p]=Object(d.f)(A),[v,w]=Object(r.useState)(!1),[N,I]=Object(r.useState)(0),[T]=Object(d.f)(M("add_liquidity")),[W,D]=Object(r.useState)({}),[L]=Object(d.f)(_);Object(r.useEffect)((()=>{}),[L,t]),Object(r.useEffect)((()=>{et("pools")}),[]),Object(r.useEffect)((()=>{le(T,W,w)}),[T,W]),Object(r.useEffect)((()=>{if(n&&s){let e=we(n,s);if(g(e),N<=1)if(e>0){let e=Ae(n,s,c);void 0!==e&&O(e)}else O(0);else if(e>0){let e=Ae(s,n,b);void 0!==e&&a(e)}else a(0)}}),[n,s,c,b,N]),Object(Ge.a)((async()=>{x>0?xe(x):(n&&ge(n),s&&ge(s))}),15e3);const z=(e,t)=>{const r=/^(([0-9]+[.]?[0-9]*)|([.][0-9]+))$/;e!==n||""!==t&&!r.test(t)||(a(t),I(1)),e!==s||""!==t&&!r.test(t)||(O(t),I(2))},F=async()=>{w(!0);let e=parseFloat(Object(j.b)(P))/100,t=Object(u.BigNumber)(c).times(Object(u.BigNumber)(1).minus(Object(u.BigNumber)(e))).toString(10),r=Object(u.BigNumber)(b).times(Object(u.BigNumber)(1).minus(Object(u.BigNumber)(e))).toString(10);console.log("Add Liquidity slippage: ",e),console.log("Add Liquidity minAmountOut: ",t,Se(n,t));try{let e=await(async(e,t,n,r,o,c)=>{console.log("AMM_add_liquidity: ",n,ke(n));const a=Object(h.getStarknet)();let s=Oe();return!1!==a.isConnected&&s&&Be()?await a.signer.invokeFunction(H,U,[ke(e),ke(t),ke(0),ke(n),ke(0),ke(r),ke(o),ke(0),ke(c),ke(0)]):null})(n,Se(n,c),Se(n,t),s,Se(s,b),Se(s,r));if(!e)throw Error("Cannot perform transaction");D((t=>({...t,[e.transaction_hash]:"new"})))}catch(o){ue("User abort","error"),w(!1)}},R=t=>{let n=[];return e.forEach(((e,r)=>{t!==r&&n.push(Object(S.jsx)(f.a,{value:r,children:Object(S.jsxs)(k.a,{container:!0,direction:"row",children:[Object(S.jsx)(k.a,{sx:{mr:1,mb:-1},children:Object(S.jsx)("img",{src:e.icon,alt:"",width:"24",height:"24"})}),Object(S.jsx)(k.a,{children:Object(S.jsx)(l.a,{children:e.symbol||e.address})})]})},r))})),n};return Object(S.jsxs)("div",{children:[Object(S.jsxs)(m.a,{sx:{p:2,border:"0px solid",mt:1,mb:4,boxShadow:2},children:[Object(S.jsx)(k.a,{container:!0,sx:{mb:4},children:Object(S.jsx)(E,{name:"Add Liquidity"})}),Object(S.jsxs)(k.a,{container:!0,spacing:2,children:[Object(S.jsxs)(k.a,{item:!0,xs:6,children:[Object(S.jsxs)(Te.a,{fullWidth:!0,children:[Object(S.jsx)(We.a,{id:"token1-label",children:"Token 1:"}),Object(S.jsx)(Pe.a,{labelId:"token1-label",id:"token1-select",value:n,label:"Token 1",onChange:e=>{let t=e.target.value;o(t),ge(t),tt("pool-token1")},children:R(s)})]}),Object(S.jsx)(Ye,{token:n,amount:de(n),showMaxButton:!0,setMaxAmountHandler:z})]}),Object(S.jsx)(k.a,{item:!0,xs:6,children:Object(S.jsx)(Te.a,{fullWidth:!0,children:Object(S.jsx)(De.a,{helperText:"Amount to provide",id:"token1-amount",inputProps:{variant:"outlined",placeholder:"0.00",type:"string",autoComplete:"off","aria-labelledby":"input-amount1"},value:c||"",onChange:e=>z(n,e.target.value),error:je(n,c)===re,disabled:""===n})})})]}),Object(S.jsxs)(k.a,{container:!0,spacing:2,sx:{mt:2},children:[Object(S.jsxs)(k.a,{item:!0,xs:6,children:[Object(S.jsxs)(Te.a,{fullWidth:!0,children:[Object(S.jsx)(We.a,{id:"token2-label",children:"Token 2:"}),Object(S.jsx)(Pe.a,{labelId:"token2-label",id:"token2-select",value:s,label:"Token 2",onChange:e=>{let t=e.target.value;i(t),ge(t),tt("pool-token2")},children:R(n)})]}),Object(S.jsx)(Ye,{token:s,amount:de(s),showMaxButton:!0,setMaxAmountHandler:z})]}),Object(S.jsx)(k.a,{item:!0,xs:6,children:Object(S.jsx)(Te.a,{fullWidth:!0,children:Object(S.jsx)(De.a,{helperText:"Amount to provide",id:"token2-amount",inputProps:{variant:"outlined",placeholder:"0.00",type:"string",autoComplete:"off","aria-labelledby":"input-amount2"},value:b||"",onChange:e=>z(s,e.target.value),error:je(s,b)===re,disabled:""===s})})})]}),(()=>{let r=t.get(x);if(!c||!b||!x||!r)return Object(S.jsx)("div",{});let o=e.get(n).symbol,a=e.get(s).symbol;console.log("-----POOL SHARE: ",c,b,Ne(r.token1,r.token1Amount)+Object(u.BigNumber)(c),Ne(r.token2,r.token2Amount));let i=be(x,s,n),d=be(x,n,s),j=r.token1===n?Object(u.BigNumber)(c).div(Object(u.BigNumber)(c).plus(Object(u.BigNumber)(Ne(r.token1,r.token1Amount)))):Object(u.BigNumber)(c).div(Object(u.BigNumber)(c).plus(Object(u.BigNumber)(Ne(r.token2,r.token2Amount))));return Object(S.jsx)(S.Fragment,{children:Object(S.jsx)(k.a,{children:Object(S.jsxs)(_e.a,{sx:{mb:2,mt:2,boxShadow:2},children:[Object(S.jsx)(at.a,{children:Object(S.jsx)(l.a,{sx:{fontSize:16,fontWeight:"500",mb:0},gutterBottom:!0,children:"Pool Prices and Share"})}),Object(S.jsx)(_e.a,{sx:{mb:0,mt:0},children:Object(S.jsxs)(k.a,{item:!0,container:!0,alignItems:"center",spacing:2,children:[Object(S.jsxs)(k.a,{item:!0,xs:4,children:[Object(S.jsx)(l.a,{sx:{textAlign:"center",lineHeight:2,mt:1,fontWeight:"bold"},children:ae(i)}),Object(S.jsxs)(l.a,{sx:{textAlign:"center",fontSize:12,mb:1},children:[o," for ",a]})]}),Object(S.jsxs)(k.a,{item:!0,xs:4,children:[Object(S.jsx)(l.a,{sx:{textAlign:"center",lineHeight:2,mt:1,fontWeight:"bold"},children:ae(d)}),Object(S.jsxs)(l.a,{sx:{textAlign:"center",fontSize:12,mb:1},children:[a," for ",o]})]}),Object(S.jsxs)(k.a,{item:!0,xs:4,children:[Object(S.jsxs)(l.a,{sx:{textAlign:"center",lineHeight:2,mt:1,fontWeight:"bold"},children:[ae(j,!0),"%"]}),Object(S.jsx)(l.a,{sx:{textAlign:"center",fontSize:12,mb:1},children:"Share of Pool"})]})]})})]})})})})(),Object(S.jsxs)(_e.a,{sx:{minWidth:275,mb:2,mt:3,boxShadow:2},children:[Object(S.jsx)(ot,{secondary:"true"}),Object(S.jsx)(Je,{token:n,tokenAmount:c,activePoolId:x,tokenInRange:je(n,c)===oe}),Object(S.jsx)(Je,{token:s,tokenAmount:b,activePoolId:x,tokenInRange:je(s,b)===oe}),(()=>{tt("add-liquidity");let e=je(n,c),t=je(s,b);if(n&&s&&c>0&&b>0&&e===oe&&t===oe&&0!==x)return Object(S.jsx)(Me.a,{color:"primary",variant:"contained",fullWidth:!0,disabled:!(p&&ie(n,c)&&ie(s,b)||v),loading:v,loadingPosition:"start",startIcon:Object(S.jsx)(it.a,{}),onClick:F,children:v?"ADDING LIQUIDITY":"ADD LIQUIDITY"});if(p&&n&&s&&c>0&&b>0&&(e!==oe||t!==oe))return Object(S.jsx)(Me.a,{color:"primary",variant:"contained",fullWidth:!0,disabled:!0,loading:e===ce||t===ce,loadingPosition:"start",startIcon:Object(S.jsx)(qe.a,{}),children:e===re||t===re?"AMOUNT EXCEEDS WALLET BALANCE":"CHECKING WALLET BALANCE"});if(n&&s&&0===x)return Object(S.jsx)(y.a,{color:"primary",variant:"contained",fullWidth:!0,disabled:!0,children:"NOT A VALID Pool"});if(p){let e="";if(n||s||(e="SELECT TOKENS"),(!n&&s||n&&!s)&&(e="SELECT TOKEN"),!n||!s||c&&b||(e="ENTER AMOUNT"),""!==e)return Object(S.jsx)(y.a,{color:"secondary",variant:"contained",fullWidth:!0,disabled:!0,children:e})}return Object(S.jsx)("div",{})})()]})]}),Object(S.jsx)(Nt,{})]})},At=n(15),Bt=n(62);At.d.register(At.c,At.i,At.k,At.h,At.o,At.p,At.f);var Ct=function(){const e=["2021-12-14","2021-12-13","2021-12-12","2021-12-11","2021-12-10","2021-12-09","2021-12-08","2021-12-07","2021-12-06","2021-12-05"],t=[{id:1,label:"",data:[9.486967291294242,9.913585044383598,6.1093149832212585,8.888170412454828,9.644500380279675,5.592256920179448,1.6120884439497363,1.6694652914713426,9.780713359093626,6.9842512776941055]}];return Object(S.jsx)("div",{children:Object(S.jsxs)(_e.a,{sx:{mb:0,mt:0},children:[Object(S.jsx)(l.a,{children:"Overview"}),Object(S.jsxs)(k.a,{item:!0,container:!0,alignItems:"center",spacing:2,children:[Object(S.jsx)(k.a,{item:!0,xs:6,children:Object(S.jsx)(Bt.a,{datasetIdKey:"id",data:{labels:e,datasets:t}})}),Object(S.jsx)(k.a,{item:!0,xs:6,children:Object(S.jsx)(Bt.a,{datasetIdKey:"id",data:{labels:e,datasets:t}})})]})]})})},_t=n(305),It=n(338);var Tt=()=>{const[e,t]=Object(r.useState)(0);return Object(S.jsxs)(m.a,{children:[Object(S.jsxs)(_t.a,{sx:{mt:3,mb:2},value:e,onChange:(e,n)=>{t(n)},centered:!0,children:[Object(S.jsx)(It.a,{className:"swap-tab",label:"Swap",sx:{fontSize:18}}),Object(S.jsx)(It.a,{className:"provide-tab",label:"Pools",sx:{fontSize:18}}),Object(S.jsx)(It.a,{className:"chart-tab",label:"Charts",sx:{fontSize:18}})]}),0===e&&Object(S.jsx)(ct,{}),1===e&&Object(S.jsx)(Et,{}),2===e&&Object(S.jsx)(Ct,{})]})};var Wt=function(e){return Object(S.jsx)("div",{children:Object(S.jsxs)(y.a,{sx:{mr:2},variant:"contained",onClick:()=>{window.open("https://goerli.voyager.online/tx/"+e.hash,"_blank")},children:["Tx ",ve(e.hash)," ",e.transactionStatus]})})};var Pt=function(){const[e]=Object(d.f)(I);return Object(Ge.a)((async()=>{e.forEach((async e=>{if(!e.dismiss){let t=await(async e=>{let t=await Object(h.getStarknet)().provider.getTransactionStatus(e),n=Object(j.b)(I);return n&&n.find((n=>n.hash===e&&n.status!==t.tx_status))?(console.log("getTransactionUpdate: ",t.tx_status,e),Object(j.c)(I,(n=>{let r=new Array;return n.forEach((n=>{if(console.log("Inside forEach: ",n.hash,n.status),n.hash===e){let e=Object.assign({},n);e.status=t.tx_status,"ACCEPTED_ON_L2"!==e.status&&"ACCEPTED_ON_L1"!==e.status||(e.dismiss=!0),r.push(e)}else r.push(n)})),r})),t.tx_status):null})(e.hash);null!==t&&(t.includes("RECEIVED")&&ue("Transaction Sent","success"),t.includes("REJECTED")&&ue("Transaction Rejected","error"),t.includes("PENDING")&&(ue("Transaction Pending","success"),he(!1),me()),t.includes("ACCEPTED")&&ue("Transaction Accepted","success"))}}))}),1e4),Object(S.jsx)(S.Fragment,{children:(()=>{let t=[];return e.forEach((e=>{e.dismiss||t.push(Object(S.jsx)(Wt,{hash:e.hash,transactionStatus:e.status,children:" "},e.hash))})),t})()})},Dt=n(312),Mt=n(307);var Lt=function(e){const[t,n]=o.a.useState(e.open),r=(e,t)=>{"clickaway"!==t&&n(!1)};return Object(S.jsx)(Dt.a,{className:"toast",open:t,autoHideDuration:6e3,onClose:r,children:Object(S.jsx)(Mt.a,{onClose:r,severity:e.type,sx:{width:"100%"},children:e.msg})})};var zt=function(){const[e]=Object(d.f)(T);return Object(S.jsx)("div",{children:(()=>{let t=[];return e.forEach((e=>{e.dismiss||t.push(Object(S.jsx)(Lt,{open:!e.dismiss,msg:e.msg,type:e.type},e.hash))})),t})()})};At.d.register(At.c,At.i,At.k,At.h,At.o,At.p,At.f);var Ft=function(){const e=e=>({responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:e}}}),t=["2021-12-14","2021-12-13","2021-12-12","2021-12-11","2021-12-10","2021-12-09","2021-12-08","2021-12-07","2021-12-06","2021-12-05"],n=[{id:1,label:"",data:[9.486967291294242,9.913585044383598,6.1093149832212585,8.888170412454828,9.644500380279675,5.592256920179448,1.6120884439497363,1.6694652914713426,9.780713359093626,6.9842512776941055]}];return Object(S.jsx)("div",{children:Object(S.jsxs)(_e.a,{sx:{mb:0,mt:0},children:[Object(S.jsx)(l.a,{children:"Overview"}),Object(S.jsxs)(k.a,{item:!0,container:!0,alignItems:"center",spacing:2,children:[Object(S.jsx)(k.a,{item:!0,xs:6,children:Object(S.jsx)(Bt.a,{options:e("TVL"),datasetIdKey:"id",data:{labels:t,datasets:n}})}),Object(S.jsx)(k.a,{item:!0,xs:6,children:Object(S.jsx)(Bt.a,{options:e("Volume"),datasetIdKey:"id",data:{labels:t,datasets:n}})})]})]})})},Rt=n(151),Ut=n(19);var qt=function(){const[e,t]=Object(r.useState)(""),[n,o]=Object(r.useState)(new Map),[c,a]=Object(r.useState)([]),[b]=Object(d.f)(C),[j]=Object(d.f)(A),[u]=Object(d.f)(L),[O]=Object(d.f)(z);Object(r.useEffect)((()=>{console.log("minter tokens effect"),b.forEach(((e,t)=>{console.log(t),n.get(t)||o((e=>{let n=new Map(e);return n.set(t,0),n}))}))}),[b,n]);const x={0:"...",1:"MINTING",2:"MINTED"},g=()=>{console.log("waiting:",c);let t=[...c],n=t.shift();console.log("address: ",n),(async(e,t)=>{const n=Object(h.getStarknet)();let r=Oe();if(!r)return null;if(!1===n.isConnected)throw Error("starknet wallet not connected");if(!Be())return null;let o=await n.signer.invokeFunction(e,$,[ke(r),ke(t),ke(0)]);fe(o.transaction_hash,"mint")})(n,Se(n,e)),a(t)};return Object(r.useEffect)((()=>{console.log("lastTxDone changed, val=",O," waitingToMint=",c),O&&c.length>0&&g()}),[O]),Object(S.jsxs)(m.a,{children:[Object(S.jsx)(k.a,{container:!0,sx:{mt:2,mb:2},children:Object(S.jsx)(m.a,{sx:{flexGrow:1},children:Object(S.jsx)(s.a,{position:"static",children:Object(S.jsx)(i.a,{children:Object(S.jsx)(l.a,{children:"Mint (testnet)"})})})})}),Object(S.jsxs)(k.a,{container:!0,spacing:2,sx:{},children:[Object(S.jsx)(k.a,{item:!0,xs:12,children:Object(S.jsx)(Te.a,{fullWidth:!0,children:Object(S.jsx)(De.a,{helperText:"Amount to mint",id:"mint-amount",inputProps:{variant:"outlined",placeholder:"0.00",type:"number",autoComplete:"off"},value:e,onChange:e=>{return n=e.target.value,void t(n);var n}})})}),Object(S.jsx)(k.a,{item:!0,xs:12,children:Object(S.jsx)(y.a,{color:"inherit",variant:"outlined",fullWidth:!0,disabled:!(j&&e>0),onClick:async()=>{console.log("will mint..."),console.log(n.entries());for(const e of n.entries()){console.log(e);let t=e[0],n=e[1];console.log("handleMint address=",t," minted=",n);let r=b.get(t);0===n&&r&&(a((e=>[...e,t])),o((e=>{let n=new Map(e);return n.set(t,1),n})))}O&&g()},children:j?e>0?"MINT":"PLEASE SET MINT AMOUNT":"PLEASE CONNECT WALLET"})}),Object(S.jsx)(k.a,{item:!0,xs:12,children:(()=>{console.log("mintedTokensList!");let e=[];return n.forEach(((t,n)=>{let r=b.get(n);console.log("walletAmounts=",u);let o=u.get(n);r&&e.push(Object(S.jsx)(_e.a,{sx:{mt:1},children:Object(S.jsxs)(k.a,{container:!0,direction:"row",children:[Object(S.jsx)(k.a,{sx:{mr:1,mb:-1},children:Object(S.jsx)("img",{src:r.icon,alt:"",width:"24",height:"24"})}),Object(S.jsx)(k.a,{children:Object(S.jsx)(l.a,{children:r.name||r.address})}),Object(S.jsx)(k.a,{sx:{ml:2},children:Object(S.jsxs)(l.a,{children:[" in wallet: ",o]})}),Object(S.jsx)(k.a,{container:!0,direction:"row",justifyContent:"flex-end",sx:{mr:1,mt:-3},children:x[t]})]})},n))})),console.log(e),e})()}),"waiting to mint:",Object(S.jsx)(k.a,{item:!0,xs:12,children:(()=>{let e=[];console.log(c);for(const t of c)e.push(Object(S.jsxs)("div",{children:["token ",t]}));return e})()})]})]})};n(240);var Gt=function(){return Object(r.useEffect)((()=>{Xe.a.initialize("UA-215866683-1"),et("/")}),[]),Object(r.useEffect)((()=>{(async()=>{(async()=>{const e=await fetch(`${Ce}/amminfo`),t=await e.json();console.log("AMM info data:",t)})(),(async()=>{const e=await fetch(`${Ce}/pools`),t=await e.json();let n=new Map;for(let r=1;r<=t.numberOfPools;r++){let e=t[r],o={id:r,name:e.poolName,token1:e.tokenAAddress,token1Amount:pe(e.tokenAReserves[0],e.tokenAReserves[1]),token2:e.tokenBAddress,token2Amount:pe(e.tokenBReserves[0],e.tokenBReserves[1]),fee:Number(e.feePercentage)/1e5,cfmm:Number(e.cfmm),shares:pe(e.shares[0],e.shares[1]),refresh:Date.now()};console.log("Pool = ",o),n.set(r,o)}Object(j.c)(B,n)})(),(async()=>{const e=await fetch(`${Ce}/tokens`),t=await e.json();let n=new Map;for(let r=0;r<t.numberOfTokens;r++){let e=t[r],o={address:e.tokenAddress,id:r,name:e.tokenName,symbol:e.tokenSymbol,icon:e.tokenIcon,decimals:e.tokenDecimals};n.set(e.tokenAddress,o),console.log("Token = ",o)}Object(j.c)(C,n)})()})(),console.log("Finished updating static data"),he(!0)}),[]),Object(Ge.a)((async()=>{he(!1)}),15e3),Object(S.jsx)(Rt.a,{children:Object(S.jsxs)(d.a,{children:[Object(S.jsx)(j.a,{}),Object(S.jsxs)("div",{className:"App",children:[Object(S.jsx)(s.a,{position:"sticky",children:Object(S.jsxs)(i.a,{children:[Object(S.jsx)(l.a,{variant:"h4",color:"inherit",component:"div",sx:{flexGrow:1},children:"mySwap"}),Object(S.jsx)(Pt,{}),Object(S.jsx)(ot,{})]})}),Object(S.jsxs)(Ut.c,{children:[Object(S.jsx)(Ut.a,{exact:!0,path:"/",children:Object(S.jsx)(b.a,{maxWidth:"sm",children:Object(S.jsx)(Tt,{})})}),Object(S.jsx)(Ut.a,{path:"/charts",children:Object(S.jsx)(Ft,{})}),Object(S.jsx)(Ut.a,{path:"/mint",children:Object(S.jsx)(b.a,{maxWidth:"sm",children:Object(S.jsx)(qt,{})})})]}),Object(S.jsx)(zt,{})]})]})})},Ht=n(303);a.a.render(Object(S.jsx)(o.a.StrictMode,{children:Object(S.jsx)(Ht.a,{children:Object(S.jsx)(Gt,{})})}),document.getElementById("root"))}},[[250,1,2]]]);
//# sourceMappingURL=main.ee34c34f.chunk.js.map